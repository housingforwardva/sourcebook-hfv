# Assisted Rentals {#assisted}

The U.S. Department of Housing and Urban Development (HUD) and U.S. Department of Agriculture (USDA) run multiple federally subsidized housing programs throughout Virginia. These programs make up most of the assisted rental housing in the state and are often combined with each other to maximize assistance for a single property.

Thanks to the National Housing Preservation Database (NHPD), data from these two agencies and their multiple programs are compiled in a single place. In addition, this data has been de-duplicated to provide a more accurate reflection of federally supported affordable housing properties.

```{r}
#| label: nhpd-data
#| eval: false

library(readxl)
library(tidyverse)
library(janitor)
library(lubridate)
library(hdatools)
library(ggtext)

va_subsidies <- read_excel("data/va_subsidies.xlsx") |> 
  clean_names() |> 
  filter(subsidy_status != "Inactive")


lihtc <- va_subsidies |> 
  filter(subsidy_name == "LIHTC") |> 
  # filter(owner_type != "Non-Profit") |> 
  mutate(end_year = year(end_date)) |> 
  mutate(period = case_when(
    end_year <= 2030 ~ "2030 or earlier",
    end_year > 2030 & end_year <= 2040 ~ "2031-2040",
    end_year > 2040 ~ "2041 or later"
  ))|> 
  group_by(period, owner_type) |> 
  summarise(total_units = sum(assisted_units)) |>
  ungroup() |> 
  mutate(percent = total_units/sum(total_units)) 

lihtc_label <- lihtc |> 
  mutate(owner_type = case_when(
    owner_type == "Non-Profit" ~ "Non-Profit",
    TRUE ~ "For Profit/Unknown"
  )) |> group_by(period, owner_type) |> 
  summarise(total = sum(total_units)) |> 
  ungroup() |> 
  mutate(percent = total/sum(total)) |> 
  mutate(label = c(paste0(number_format(big.mark = ",")(total), "\n", percent(percent, accuracy = 1))))

ggplot(lihtc_label,
       aes(x = period,
           y = percent,
           fill = period)) +
  facet_wrap(~owner_type, nrow = 1) +
  geom_col(position = "dodge") +
  geom_text(aes(label = label), vjust = -0.5, size = 4.5, color = "#011E41") +
  theme_hfv(base_size = 15) + 
  scale_fill_hfv() +
  scale_y_continuous(labels = percent_format(), limits = c(0,0.6)) +
  labs(title = "Total at-risk LIHTC units by owner type",
       caption = "**Source:** National Housing Preservation Database. <br> **Note:** The data source for LIHTC was lasted updated on 4/28/22.")
  




```